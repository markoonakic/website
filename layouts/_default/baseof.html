{{ $page := . }}

{{ $attrs := slice }}
{{ $microdata := $page.Params.microdata }}

{{ range $k, $v := $microdata }}
    {{ $attrs = $attrs | append (printf `%s="%v"` $k $v) }}
{{ end }}

{{ $attrs = delimit (sort $attrs) " " }}

{{ $titles := slice }}

{{ if $page.IsHome }}
    {{ $same := and $page.Title site.Title (eq $page.Title site.Title) }}

    {{ if $same }}
        {{ $titles = slice (site.Title | markdownify | plainify | htmlUnescape) }}
    {{ else }}
        {{ if $page.Title }}
            {{ $titles = $titles | append ($page.Title | markdownify | plainify | htmlUnescape) }}
        {{ end }}

        {{ if site.Title }}
            {{ $titles = $titles | append (site.Title | markdownify | plainify | htmlUnescape) }}
        {{ end }}
    {{ end }}
{{ else }}
    {{ with $page.Title }}
        {{ $titles = slice (. | markdownify | plainify | htmlUnescape) }}
    {{ end }}

    {{ range .Ancestors }}
        {{ $title := cond .IsHome (site.Title | default .Title) .Title }}

        {{ with $title }}
            {{ $titles = $titles | append (. | markdownify | plainify | htmlUnescape) }}
        {{ end }}
    {{ end }}
{{ end }}

{{ $title := delimit $titles " Â· " }}

{{ $dark := eq ($page.Param "params.color_scheme") "dark" }}
{{ $lang := site.LanguageCode }}
{{ $rtl := eq $page.Language.LanguageDirection "rtl" }}

{{ $authors := partial "func-authors.html" $page }}
{{ $author := slice }}

{{ range $authors }}
    {{ $author = $author | append (.Params.author.name | default (.Title | markdownify | plainify | htmlUnescape)) }}
{{ end }}

{{ $author = delimit $author ", " }}

{{ $color := $page.Param `params.color` | default `#df4655` }}
{{ $description := cond $page.IsHome ($page.Description | default ($page.Param "params.description")) $page.Description | markdownify | plainify | htmlUnescape }}
{{ $keywords := partial "func-keywords.html" $page }}

<!doctype html>
<html {{ if $dark }} data-bs-theme="dark" {{ end }} {{ if $rtl }} dir="rtl" {{ end }} {{ with $lang }} lang="{{ . }}" {{ end }}>
<head>
    <meta charset="utf-8">
    <meta content="{{ site.Title | markdownify | plainify | htmlUnescape }}" name="apple-mobile-web-app-title">

    {{ with $author }}
        <meta content="{{ . }}" name="author">
    {{ end }}

    {{ with $description }}
        <meta content="{{ . }}" name="description">
    {{ end }}

    {{ with $keywords }}
        <meta content="{{ . }}" name="keywords">
    {{ end }}

    <meta content="{{ $color }}" name="theme-color">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    {{ with $title }}
        <title>{{ . }}</title>
    {{ end }}

    {{ template "_internal/opengraph.html" $page }}
    {{ template "_internal/twitter_cards.html" $page }}

    <link rel="icon" href="{{ relLangURL `favicon.svg` }}" type="image/svg+xml">
    <link rel="alternate icon" href="{{ relLangURL `favicon.ico` }}" type="image/x-icon">

    {{ if fileExists "static/apple-touch-icon.png" }}
        <link href="{{ relLangURL `apple-touch-icon.png` }}" rel="apple-touch-icon" sizes="180x180">
    {{ end }}

    {{ if fileExists "static/web-app-manifest-192x192.png" }}
        <link href="{{ relLangURL `web-app-manifest-192x192.png` }}" rel="icon" type="image/png">
    {{ end }}

    {{ if fileExists "static/web-app-manifest-512x512.png" }}
        <link href="{{ relLangURL `web-app-manifest-512x512.png` }}" rel="icon" type="image/png">
    {{ end }}

    {{ if fileExists "assets/site.webmanifest" }}
        <link href="{{ (resources.Get `site.webmanifest` | resources.ExecuteAsTemplate `site.webmanifest` .).RelPermalink }}" rel="manifest">
    {{ end }}

    {{ range $page.AlternativeOutputFormats }}
        <link href="{{ .RelPermalink }}" rel="{{ .Rel }}" type="{{ .MediaType }}">
    {{ end }}

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    {{ with $page.Param "params.style" }}
        <style>{{ . | safeCSS }}</style>
    {{ end }}

    {{ partial "head-last.html" $page }}
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col mt-3" id="site" {{ with $attrs }} {{ $attrs | safeHTMLAttr }} {{ end }}>
                {{ partial "site-header.html" $page }}
                {{ block "main" $page }}{{ end }}
                {{ partial "site-footer.html" $page }}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    {{ partial "schema.html" $page }}

    <noscript>JavaScript is required</noscript>

    {{ partial "body-last.html" $page }}
</body>
</html>
