<!-- Mermaid.js Library -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'base',
    securityLevel: 'loose',
    flowchart: {
      useMaxWidth: true,
      htmlLabels: true,
      curve: 'basis'
    }
  });

  // Add hover effects after Mermaid renders
  document.addEventListener('DOMContentLoaded', function() {
    // Wait for Mermaid to finish rendering
    setTimeout(function() {
      const mermaidContainers = document.querySelectorAll('.mermaid');
      mermaidContainers.forEach(container => {
        const svg = container.querySelector('svg');
        if (svg) {
          // Add hover effects to nodes
          const nodes = svg.querySelectorAll('g[data-id] rect');
          nodes.forEach(rect => {
            const originalFill = rect.getAttribute('fill');
            if (originalFill && originalFill !== 'transparent') {
              // Calculate brighter color
              const brighterColor = brightenColor(originalFill);
              rect.style.transition = 'fill 0.2s ease';
              rect.addEventListener('mouseenter', function() {
                this.setAttribute('fill', brighterColor);
              });
              rect.addEventListener('mouseleave', function() {
                this.setAttribute('fill', originalFill);
              });
            }
          });
        }
      });
    }, 1000);
  });

  function brightenColor(color) {
    // Simple color brightening function
    if (color.startsWith('#')) {
      const r = parseInt(color.slice(1, 3), 16);
      const g = parseInt(color.slice(3, 5), 16);
      const b = parseInt(color.slice(5, 7), 16);

      // Brighten by 20%
      const newR = Math.min(255, Math.floor(r * 1.2));
      const newG = Math.min(255, Math.floor(g * 1.2));
      const newB = Math.min(255, Math.floor(b * 1.2));

      return `#${newR.toString(16).padStart(2, '0')}${newG.toString(16).padStart(2, '0')}${newB.toString(16).padStart(2, '0')}`;
    }
    return color;
  }
</script>
