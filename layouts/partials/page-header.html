{{ $page := . }}

{{ $alert := $page.Param "params.alert" }}
{{ $authors := partial "func-authors.html" $page | and ($page.Param "params.disable_authors" | not) }}
{{ $categories := $page.GetTerms "categories" }}
{{ $date := false }}
{{ if $page.IsPage }}
    {{ if $page.PublishDate }}
        {{ $disableDate := $page.Param "params.disable_date" }}
        {{ $isAboutPage := eq $page.RelPermalink "/about/" }}
        {{ $isIndexPage := eq $page.RelPermalink "/index/" }}
        {{ $isSearchPage := eq $page.RelPermalink "/search/" }}
        {{ $shouldDisableDate := or (eq $disableDate true) (eq $disableDate "true") (eq $disableDate "True") $isAboutPage $isIndexPage $isSearchPage }}
        {{ if not $shouldDisableDate }}
            {{ $date = $page.PublishDate }}
        {{ end }}
    {{ end }}
{{ end }}
{{ $description := $page.Description | markdownify | and ($page.Param "params.disable_description" | not) }}
{{ $format := $page.Param "params.date_format" | default ":date_long" }}
{{ $link := $page.Params.link }}
{{ $microdata := $page.Params.microdata }}
{{ $normal := eq ($page.Param "params.keyword_style" | default "text") "text" }}
{{ $series := $page.GetTerms "series" | and ($page.Param "params.disable_series" | not) }}
{{ $tags := $page.GetTerms "tags" }}
{{ $title := false }}
{{ $disableTitle := $page.Param "params.disable_title" }}
{{ $shouldDisableTitle := or (eq $disableTitle true) (eq $disableTitle "true") (eq $disableTitle "True") }}
{{ if not $shouldDisableTitle }}
    {{ $title = $page.Title | markdownify }}
{{ end }}
{{ $toc := and $page.Content (ne $page.TableOfContents `<nav id="TableOfContents"></nav>`) | and ($page.Param "params.disable_toc" | not) }}

{{ $keywords := sort (append $categories $tags) "LinkTitle" | and ($page.Param "params.disable_keywords" | not) }}
{{ $rssUrl := "" }}
{{ if eq $page.RelPermalink "/index/" }}
    {{ $rssUrl = "/index.xml" }}
{{ end }}
{{ $isHomePage := or $page.IsHome (eq $page.Kind "home") (eq $page.RelPermalink "/") }}

{{ if and (not $isHomePage) (or $alert $authors $date $description $keywords $series $title $toc $rssUrl) }}
    <header class="mw-100 text-center" id="page-header">

        {{ if or $title $rssUrl }}
            <div class="d-flex align-items-center justify-content-center gap-3 mb-4" id="page-title-container">
                {{ with $title }}
                    <h1 class="fw-bold mb-0" id="page-title" {{ if $microdata }} itemprop="headline name" {{ end }}>{{ if $link }}<a href="{{ $link }}">{{ . }}</a>{{ else }}{{ . }}{{ end }}</h1>
                {{ end }}
                {{ if $rssUrl }}
                    <a href="{{ $rssUrl }}" class="blog-rss-link" aria-label="RSS Feed" title="Subscribe to RSS Feed">
                        <i class="bi bi-rss-fill" aria-hidden="true"></i>
                    </a>
                {{ end }}
            </div>
        {{ end }}

        {{ with $description }}
            <p class="lead row-tall" id="page-description" {{ if $microdata }} itemprop="alternativeHeadline description" {{ end }}>{{ . }}</p>
        {{ end }}

        {{ if or $authors $date $keywords $series }}
            <div>
                {{ with $keywords }}
                    <p class="{{ if $normal }} row-short {{ end }} {{ if $normal }} text-secondary {{ end }}" id="page-keywords">
                        {{ range $i, $term := . }}
                            {{ $kind := false }}

                            {{ if in $categories $term }}
                                {{ $kind = "category" }}
                            {{ else }}
                                {{ $kind = "tag" }}
                            {{ end }}

                            {{ if $normal }}
                                {{ if gt $i 0 }}<span class="meta-separator">·</span>{{ end }}
                                {{ if .RelPermalink }}
                                    <a class="link-secondary page-keyword-{{ $kind }}" href="{{ .RelPermalink }}" {{ if $microdata }} itemprop="keywords" {{ end }}>{{ .LinkTitle }}</a>
                                {{ else }}
                                    <span class="text-secondary page-keyword-{{ $kind }}" {{ if $microdata }} itemprop="keywords" {{ end }}>{{ .LinkTitle }}</span>
                                {{ end }}
                            {{ else }}
                                {{ if gt $i 0 }} {{ end }}
                                {{ if .RelPermalink }}
                                    <a class="badge page-keyword-{{ $kind }} text-bg-secondary text-decoration-none" href="{{ .RelPermalink }}" {{ if $microdata }} itemprop="keywords" {{ end }}>{{ .LinkTitle }}</a>
                                {{ else }}
                                    <span class="badge page-keyword-{{ $kind }} text-bg-secondary" {{ if $microdata }} itemprop="keywords" {{ end }}>{{ .LinkTitle }}</span>
                                {{ end }}
                            {{ end }}
                        {{ end }}
                    </p>
                {{ end }}

                {{ with $series }}
                    <p class="row-short text-secondary" id="page-series">
                        {{ range $i, $series := . }}
                            {{ if gt $i 0 }}<span class="meta-separator">·</span>{{ end }}
                            {{ if .RelPermalink }}
                                <a class="link-secondary" href="{{ .RelPermalink }}" {{ if $microdata }} itemprop="isPartOf" {{ end }}>{{ .LinkTitle }}</a>
                            {{ else }}
                                <span class="text-secondary" {{ if $microdata }} itemprop="isPartOf" {{ end }}>{{ .LinkTitle }}</span>
                            {{ end }}
                        {{ end }}
                    </p>
                {{ end }}

                {{ with $authors }}
                    <p class="row-short text-secondary" id="page-authors">
                        {{ range $i, $author := . }}
                            {{ if gt $i 0 }}<span class="meta-separator">·</span>{{ end }}
                            {{ if .RelPermalink }}
                                <a class="link-secondary" href="{{ .RelPermalink }}" {{ if $microdata }} itemprop="author" {{ end }}>{{ .LinkTitle }}</a>
                            {{ else }}
                                <span class="text-secondary" {{ if $microdata }} itemprop="author" {{ end }}>{{ .LinkTitle }}</span>
                            {{ end }}
                        {{ end }}
                    </p>
                {{ end }}

                {{ with $date }}
                    <p class="row-short text-secondary" id="page-date">
                        <time datetime="{{ .Format `2006-01-02` }}" {{ if $microdata }} itemprop="datePublished" {{ end }}>{{ time.Format $format . }}</time>
                        <span class="meta-separator">·</span>
                        <span>Marko Nakić</span>
                    </p>
                {{ end }}
            </div>
        {{ end }}

        {{ with $alert }}
            <div class="alert alert-{{ .type }} row-tall" id="page-alert" role="alert">{{ .message | markdownify }}</div>
        {{ end }}

        {{ if $toc }}
            <div class="align-items-center d-flex flex-column row-tall text-center" id="page-toc">
                <details class="toc-collapsible">
                    <summary class="toc-summary">Table of Contents</summary>
                    <div class="toc-anim-wrapper">
                        <div class="toc-content">
                            {{ .TableOfContents }}
                        </div>
                    </div>
                </details>
            </div>
        {{ end }}

    </header>
{{ end }}
